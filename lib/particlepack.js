webpackJsonp([13],{0:function(a,b,c){a.exports=c(421)},421:function(a,b,c){if(a.exports={ParticleSystemComponent:c(422),ConstantCurve:c(424),Curve:c(425),LerpCurve:c(426),LinearCurve:c(427),PolyCurve:c(428),Vector3Curve:c(429),Vector4Curve:c(430),ParticleSystemComponentHandler:c(431),ParticleData:c(423),ParticleDebugRenderSystem:c(432),ParticleSystemSystem:c(433)},"undefined"!=typeof window)for(var d in a.exports)window.goo[d]=a.exports[d]},422:function(a,b,c){function d(a,b){return(a%b+b)%b}function e(a){a=a||{},m.apply(this,arguments),this.type="ParticleSystemComponent",this.material=new k({defines:t.clone(u),processors:[o.uber.fog],attributes:{vertexPosition:j.POSITION,timeInfo:"TIME_INFO",startPos:"START_POS",startDir:"START_DIR",vertexUV0:j.TEXCOORD0},uniforms:{viewMatrix:n.VIEW_MATRIX,projectionMatrix:n.PROJECTION_MATRIX,viewProjectionMatrix:n.VIEW_PROJECTION_MATRIX,worldMatrix:n.WORLD_MATRIX,cameraPosition:n.CAMERA,textureTileInfo:[1,1,1,0],invWorldRotation:[1,0,0,0,1,0,0,0,1],worldRotation:[1,0,0,0,1,0,0,0,1],particleTexture:"PARTICLE_TEXTURE",time:0,duration:5,gravity:[0,0,0],discardThreshold:0,uColor:[1,1,1,1],uStartSize:1,uStartAngle:1,uRotationSpeed:1,fogSettings:[0,1e4],fogColor:[1,1,1]},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","attribute vec4 timeInfo;","attribute vec4 startPos;","attribute vec4 startDir;","uniform vec4 textureTileInfo;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat3 invWorldRotation;","uniform mat3 worldRotation;","uniform vec3 cameraPosition;","uniform float time;","uniform float duration;","uniform vec3 gravity;","uniform vec4 uColor;","uniform float uStartSize;","uniform float uStartAngle;","uniform float uRotationSpeed;","#ifdef FOG","uniform vec2 fogSettings;","uniform vec3 fogColor;","#endif","varying vec4 color;","varying vec2 coords;","vec3 getVelocityCurveIntegral(float t, float emitRandom) {","    return VELOCITY_CURVE_CODE;","}","vec3 getWorldVelocityCurveIntegral(float t, float emitRandom) {","    return WORLD_VELOCITY_CURVE_CODE;","}","vec3 getPosition(mat3 invWorldRotation, mat3 worldRotation, float t, vec3 pos, vec3 vel, vec3 g, float emitRandom, float duration) {","    return pos + vel * t + 0.5 * t * t * g + worldRotation * getVelocityCurveIntegral(t / duration, emitRandom) + invWorldRotation * getWorldVelocityCurveIntegral(t / duration, emitRandom);","}","float getScale(float t, float emitRandom) {","    return SIZE_CURVE_CODE;","}","float getStartSize(float t, float emitRandom) {","    return START_SIZE_CODE;","}","float getTextureFrame(float t, float emitRandom) {","    return TEXTURE_FRAME_CODE;","}","float getAngle(float t, float emitRandom) {","    return ROTATION_CURVE_CODE;","}","vec4 getColor(float t, float emitRandom) {","    return COLOR_CURVE_CODE;","}","vec4 getStartColor(float t, float emitRandom) {","    return START_COLOR_CODE;","}","float getStartAngle(float t, float emitRandom) {","    return START_ROTATION_CURVE_CODE;","}","mat4 rotationMatrix(vec3 axis, float angle) {","    axis = normalize(axis);","    float s = sin(angle);","    float c = cos(angle);","    float x = axis.x;","    float y = axis.y;","    float z = axis.z;","    float oc = 1.0 - c;","    return mat4(oc * x * x + c, oc * x * y - z * s,  oc * z * x + y * s,  0.0,","    oc * x * y + z * s, oc * y * y + c, oc * y * z - x * s, 0.0,","    oc * z * x - y * s, oc * y * z + x * s,  oc * z * z + c, 0.0,","    0.0, 0.0, 0.0, 1.0);","}","void main(void) {","    float active = timeInfo.y;","    float emitTime = timeInfo.w;","    float age = time - emitTime;","    float ageNoMod = age;","    float loopAfter = startDir.w;","    #ifdef LOOP","    age = mod(age, loopAfter);","    emitTime = mod(emitTime, loopAfter);","    #endif","    float unitEmitTime = mod(emitTime / duration, 1.0);","    float emitRandom = timeInfo.z;","    float startSize = uStartSize * getStartSize(unitEmitTime, emitRandom);","    float lifeTime = timeInfo.x;","    float startAngle = uStartAngle * getStartAngle(unitEmitTime, emitRandom);","    float unitAge = age / lifeTime;","    color = uColor * getStartColor(unitAge, emitRandom) * getColor(unitAge, emitRandom);","    float textureAnimationCycles = textureTileInfo.z;","    float tileX = floor(mod(textureTileInfo.x * textureTileInfo.y * getTextureFrame(unitAge, emitRandom) * textureAnimationCycles, textureTileInfo.x));","    float tileY = floor(mod(-textureTileInfo.y * getTextureFrame(unitAge, emitRandom) * textureAnimationCycles, textureTileInfo.y));","    vec2 texOffset = vec2(tileX, tileY) / textureTileInfo.xy;","    coords = (vertexUV0 / textureTileInfo.xy + texOffset);","    float rotation = uRotationSpeed * getAngle(unitAge, emitRandom) + startAngle;","    float c = cos(rotation);","    float s = sin(rotation);","    mat3 spinMatrix = mat3(c, s, 0, -s, c, 0, 0, 0, 1);","    active *= step(-lifeTime, -age);","    #ifdef HIDE_IF_EMITTED_BEFORE_ZERO","    active *= step(0.0, ageNoMod) * step(0.0, age);","    #endif","    vec3 position = getPosition(invWorldRotation, worldRotation, age, startPos.xyz, startDir.xyz, gravity, emitRandom, duration);","    #ifdef FOG","    vec3 viewPosition = cameraPosition - (worldMatrix * vec4(position, 0.0)).xyz;","    float d = pow(smoothstep(fogSettings.x, fogSettings.y, length(viewPosition)), 1.0);","    color.rgb = mix(color.rgb, fogColor, d);","    #endif","    #ifdef BILLBOARD","    vec2 offset = ((spinMatrix * vertexPosition)).xy * startSize * getScale(unitAge, emitRandom) * active;","    mat4 matPos = worldMatrix * mat4(vec4(0),vec4(0),vec4(0),vec4(position,0));","    gl_Position = viewProjectionMatrix * (worldMatrix + matPos) * vec4(0, 0, 0, 1) + projectionMatrix * vec4(offset.xy, 0, 0);","    #else","    mat4 rot = rotationMatrix(normalize(vec3(sin(emitTime*5.0),cos(emitTime*1234.0),sin(emitTime))),rotation);","    gl_Position = viewProjectionMatrix * worldMatrix * (rot * vec4(startSize * getScale(unitAge, emitRandom) * active * vertexPosition, 1.0) + vec4(position,0.0));","    #endif","}"].join("\n"),fshader:["uniform sampler2D particleTexture;","uniform float discardThreshold;","varying vec4 color;","varying vec2 coords;","void main(void) {","#ifdef PARTICLE_TEXTURE","    vec4 col = color * texture2D(particleTexture, coords);","#else","    vec4 col = color;","#endif","    if (col.a < discardThreshold) discard;","    gl_FragColor = col;","}"].join("\n")}),this.material.cullState.enabled=!1,this.material.uniforms.textureTileInfo=[1,1,1,0],t.extend(this.material.uniforms,{textureTileInfo:[1,1,1,0],invWorldRotation:[1,0,0,0,1,0,0,0,1],worldRotation:[1,0,0,0,1,0,0,0,1],gravity:[0,0,0],uColor:[1,1,1,1]}),this._nextEmitParticleIndex=0,this._localGravity=new h,this._lastTime=this.time,this._worldToLocalRotation=new g,this._localToWorldRotation=new g,this.entity=null,this.paused=void 0!==a.paused?a.paused:!1,this.autoPlay=void 0!==a.autoPlay?a.autoPlay:!0,this.particles=[],this.particlesSorted=[],this.time=a.time||0,this.gravity=a.gravity?a.gravity.clone():new h,this.boxExtents=a.boxExtents?a.boxExtents.clone():new h(1,1,1),this.startColorScale=a.startColorScale?a.startColorScale.clone():new i(1,1,1,1),this.emissionRate=a.emissionRate?a.emissionRate.clone():new s({value:10}),this.preWarm=void 0!==a.preWarm?a.preWarm:!1,this._initSeed=this._seed=this.seed=void 0!==a.seed&&a.seed>0?a.seed:Math.floor(32768*Math.random()),this.shapeType=a.shapeType||"cone",this.sphereRadius=void 0!==a.sphereRadius?a.sphereRadius:1,this.sphereEmitFromShell=a.sphereEmitFromShell||!1,this.randomDirection=a.randomDirection||!1,this.coneEmitFrom=a.coneEmitFrom||"base",this.coneRadius=void 0!==a.coneRadius?a.coneRadius:1,this.coneAngle=void 0!==a.coneAngle?a.coneAngle:Math.PI/8,this.coneLength=void 0!==a.coneLength?a.coneLength:1,this.startColor=a.startColor?a.startColor.clone():null,this.colorOverLifetime=a.colorOverLifetime?a.colorOverLifetime.clone():null,this.duration=void 0!==a.duration?a.duration:5,this.localSpace=void 0!==a.localSpace?a.localSpace:!0,this.startSpeed=a.startSpeed?a.startSpeed.clone():new s({value:5}),this.localVelocityOverLifetime=a.localVelocityOverLifetime?a.localVelocityOverLifetime.clone():null,this.worldVelocityOverLifetime=a.worldVelocityOverLifetime?a.worldVelocityOverLifetime.clone():null,this._maxParticles=void 0!==a.maxParticles?a.maxParticles:100,this.startLifetime=a.startLifetime?a.startLifetime.clone():new s({value:5}),this.renderQueue=void 0!==a.renderQueue?a.renderQueue:3010,this.discardThreshold=a.discardThreshold||0,this.loop=void 0!==a.loop?a.loop:!0,this.blending=a.blending||"NoBlending",this.depthWrite=void 0!==a.depthWrite?a.depthWrite:!0,this.depthTest=void 0!==a.depthTest?a.depthTest:!0,this.textureTilesX=void 0!==a.textureTilesX?a.textureTilesX:1,this.textureTilesY=void 0!==a.textureTilesY?a.textureTilesY:1,this.textureAnimationCycles=void 0!==a.textureAnimationCycles?a.textureAnimationCycles:1,this.textureFrameOverLifetime=a.textureFrameOverLifetime?a.textureFrameOverLifetime.clone():null,this.startSize=a.startSize?a.startSize.clone():null,this.sortMode=void 0!==a.sortMode?a.sortMode:e.SORT_NONE,this.mesh=a.mesh?a.mesh:new r,this.billboard=void 0!==a.billboard?a.billboard:!0,this.sizeOverLifetime=a.sizeOverLifetime?a.sizeOverLifetime.clone():null,this.startAngle=a.startAngle?a.startAngle.clone():null,this.rotationSpeedOverLifetime=a.rotationSpeedOverLifetime?a.rotationSpeedOverLifetime.clone():null,this.texture=a.texture?a.texture:null,this.boundsRadius=void 0!==a.boundsRadius?a.boundsRadius:Number.MAX_VALUE}function f(a,b){a.rotation.copy(b.rotation),a.translation.copy(b.translation),a.update()}var g=c(24),h=c(8),i=c(11),j=c(14),k=c(30),l=c(215),m=c(20),n=c(31),o=c(48),p=c(423),q=c(123),r=c(28),s=c(424),t=c(6);Math.cbrt=Math.cbrt||function(a){var b=Math.pow(Math.abs(a),1/3);return 0>a?-b:b};var u={START_LIFETIME_CODE:"5.0",START_SIZE_CODE:"1.0",START_ROTATION_CURVE_CODE:"0.0",START_COLOR_CODE:"vec4(1.0)",SIZE_CURVE_CODE:"1.0",ROTATION_CURVE_CODE:"0.0",COLOR_CURVE_CODE:"vec4(1.0)",VELOCITY_CURVE_CODE:"vec3(0.0)",WORLD_VELOCITY_CURVE_CODE:"vec3(0.0)",TEXTURE_FRAME_CODE:"t"};e.prototype=Object.create(m.prototype),e.prototype.constructor=e,e.type="ParticleSystemComponent",e.SORT_NONE=1,e.SORT_CAMERA_DISTANCE=2,Object.defineProperties(e.prototype,{billboard:{get:function(){return this.material.shader.hasDefine("BILLBOARD")},set:function(a){var b=this.material.shader;a?b.setDefine("BILLBOARD",!0):b.removeDefine("BILLBOARD")}},blending:{get:function(){return this.material.blendState.blending},set:function(a){this.material.blendState.blending=a}},colorOverLifetime:{get:function(){return this._colorOverLifetime},set:function(a){this._colorOverLifetime=a,this.material.shader.setDefine("COLOR_CURVE_CODE",a?a.toGLSL("t","emitRandom"):u.COLOR_CURVE_CODE)}},coneAngle:{get:function(){return this._coneAngle},set:function(a){this._coneAngle=a,this._vertexDataDirty=!0}},coneEmitFrom:{get:function(){return this._coneEmitFrom},set:function(a){this._coneEmitFrom=a,this._vertexDataDirty=!0}},coneLength:{get:function(){return this._coneLength},set:function(a){this._coneLength=a,this._vertexDataDirty=!0}},coneRadius:{get:function(){return this._coneRadius},set:function(a){this._coneRadius=a,this._vertexDataDirty=!0}},depthTest:{get:function(){return this.material.depthState.enabled},set:function(a){this.material.depthState.enabled=a}},depthWrite:{get:function(){return this.material.depthState.write},set:function(a){this.material.depthState.write=a}},discardThreshold:{get:function(){return this.material.uniforms.discardThreshold},set:function(a){this.material.uniforms.discardThreshold=a}},duration:{get:function(){return this.material.uniforms.duration},set:function(a){this.material.uniforms.duration=a,this._vertexDataDirty=!0}},emissionRate:{get:function(){return this._emissionRate},set:function(a){this._emissionRate=a,this._vertexDataDirty=!0}},localSpace:{get:function(){return this._localSpace},set:function(a){if(this._localSpace=a,this.meshEntity){var b=this.meshEntity.transformComponent;b.transform.setIdentity(),b.setUpdated()}}},localVelocityOverLifetime:{get:function(){return this._localVelocityOverLifetime},set:function(a){this._localVelocityOverLifetime=a,this.material.shader.setDefine("VELOCITY_CURVE_CODE",a?a.integralToGLSL("t","emitRandom"):u.VELOCITY_CURVE_CODE)}},loop:{get:function(){return this._loop},set:function(a){this._loop=a,this._vertexDataDirty=!0}},maxParticles:{get:function(){return this._maxParticles},set:function(a){this._maxParticles=a;var b=this.mesh,c=this.meshData;a*b.vertexCount!==c.vertexCount&&(c.vertexCount=a*b.vertexCount,c.indexCount=a*b.indexCount,c.rebuildData(c.vertexCount,c.indexCount),this._syncParticleDataArrays(),this._updateVertexData(),this._updateIndexBuffer(this.particles),this._vertexDataDirty=!0)}},mesh:{get:function(){return this._mesh},set:function(a){this._mesh=a;var b=this.meshData;b&&(b.vertexCount=this.maxParticles*a.vertexCount,b.indexCount=this.maxParticles*a.indexCount,b.rebuildData(b.vertexCount,b.indexCount),this._vertexDataDirty=!0)}},preWarm:{get:function(){return this._preWarm},set:function(a){this._preWarm=a,this._vertexDataDirty=!0}},randomDirection:{get:function(){return this._randomDirection},set:function(a){this._randomDirection=a,this._vertexDataDirty=!0}},renderQueue:{get:function(){return this.material.renderQueue},set:function(a){this.material.renderQueue=a}},rotationSpeedOverLifetime:{get:function(){return this._rotationSpeedOverLifetime},set:function(a){this._rotationSpeedOverLifetime=a,this.material.shader.setDefine("ROTATION_CURVE_CODE",a?a.integralToGLSL("t","emitRandom"):u.ROTATION_CURVE_CODE)}},rotationSpeedScale:{get:function(){return this.material.uniforms.uRotationSpeed},set:function(a){this.material.uniforms.uRotationSpeed=a}},seed:{get:function(){return this._initSeed},set:function(a){a!==this._initSeed&&(this._initSeed=a,this._vertexDataDirty=!0)}},shapeType:{get:function(){return this._shapeType},set:function(a){this._shapeType=a,this._vertexDataDirty=!0}},sizeOverLifetime:{get:function(){return this._sizeOverLifetime},set:function(a){this._sizeOverLifetime=a,this.material.shader.setDefine("SIZE_CURVE_CODE",a?a.toGLSL("t","emitRandom"):u.SIZE_CURVE_CODE)}},sortMode:{get:function(){return this._sortMode},set:function(a){this._sortMode=a;var b=this.meshData,c=this.mesh;b&&c&&this._updateIndexBuffer(this.particles)}},sphereEmitFromShell:{get:function(){return this._sphereEmitFromShell},set:function(a){this._sphereEmitFromShell=a,this._vertexDataDirty=!0}},startAngle:{get:function(){return this._startAngle},set:function(a){this._startAngle=a,this.material.shader.setDefine("START_ROTATION_CURVE_CODE",a?a.toGLSL("t","emitRandom"):u.START_ROTATION_CURVE_CODE)}},startAngleScale:{get:function(){return this.material.uniforms.uStartAngle},set:function(a){this.material.uniforms.uStartAngle=a}},startColor:{get:function(){return this._startColor},set:function(a){this._startColor=a,this.material.shader.setDefine("START_COLOR_CODE",a?a.toGLSL("t","emitRandom"):u.START_COLOR_CODE)}},startLifetime:{get:function(){return this._startLifetime},set:function(a){this._startLifetime=a,this.material.shader.setDefine("START_LIFETIME_CODE",a?a.toGLSL("t","emitRandom"):u.START_LIFETIME_CODE)}},startSize:{get:function(){return this._startSize},set:function(a){this._startSize=a,this.material.shader.setDefine("START_SIZE_CODE",a?a.toGLSL("t","emitRandom"):u.START_SIZE_CODE)}},startSizeScale:{get:function(){return this.material.uniforms.uStartSize},set:function(a){this.material.uniforms.uStartSize=a}},startSpeed:{get:function(){return this._startSpeed},set:function(a){this._startSpeed=a,this._vertexDataDirty=!0}},texture:{get:function(){return this.material.getTexture("PARTICLE_TEXTURE")},set:function(a){var b=this.material,c=b.shader;a?(b.setTexture("PARTICLE_TEXTURE",a),c.setDefine("PARTICLE_TEXTURE",!0)):(b.removeTexture("PARTICLE_TEXTURE"),c.removeDefine("PARTICLE_TEXTURE"))}},textureAnimationCycles:{get:function(){return this.material.uniforms.textureTileInfo[2]},set:function(a){this.material.uniforms.textureTileInfo[2]=a}},textureFrameOverLifetime:{get:function(){return this._textureFrameOverLifetime},set:function(a){this._textureFrameOverLifetime=a,this.material.shader.setDefine("TEXTURE_FRAME_CODE",a?a.toGLSL("t","emitRandom"):u.TEXTURE_FRAME_CODE)}},textureTilesX:{get:function(){return this.material.uniforms.textureTileInfo[0]},set:function(a){this.material.uniforms.textureTileInfo[0]=a}},textureTilesY:{get:function(){return this.material.uniforms.textureTileInfo[1]},set:function(a){this.material.uniforms.textureTileInfo[1]=a}},worldVelocityOverLifetime:{get:function(){return this._worldVelocityOverLifetime},set:function(a){this._worldVelocityOverLifetime=a,this.material.shader.setDefine("WORLD_VELOCITY_CURVE_CODE",a?a.integralToGLSL("t","emitRandom"):u.WORLD_VELOCITY_CURVE_CODE)}}}),e.prototype.setBoxExtents=function(a){this.boxExtents.copy(a),this._vertexDataDirty=!0},e.prototype._random=function(){var a=1e5*Math.sin(this._seed++);return a-Math.floor(a)},e.prototype._updateUniforms=function(){var a=this.material.uniforms,b=this._worldToLocalRotation,c=this._localToWorldRotation;this.localSpace?(b.copy(this.meshEntity.transformComponent.sync().worldTransform.rotation).invert(),c.copy(g.IDENTITY)):(b.copy(g.IDENTITY),c.copy(this.entity.transformComponent.sync().worldTransform.rotation));var d=this._localGravity;d.copy(this.gravity),d.applyPost(b);var e=a.gravity;e[0]=d.x,e[1]=d.y,e[2]=d.z;for(var f=0;9>f;f++)a.invWorldRotation[f]=b.data[f],a.worldRotation[f]=c.data[f];a.time=this.time;var h=a.uColor,i=this.startColorScale;h[0]=i.x,h[1]=i.y,h[2]=i.z,h[3]=i.w},e.prototype._updateIndexBuffer=function(a){var b=this.mesh,c=this.meshData,d=b.getIndexBuffer(),e=c.getIndexBuffer();c.getIndexData().setDataNeedsRefresh();for(var f=b.vertexCount,g=0;g<a.length;g++)for(var h=0;h<d.length;h++)e[g*d.length+h]=d[h]+a[g].index*f},e.prototype.pause=function(){this.paused=!0},e.prototype.resume=function(){this.play()},e.prototype.play=function(){this.paused=!1},e.prototype.stop=function(){this.pause(),this.time=0,this._seed=this._initSeed,this._nextEmitParticleIndex=0,this._syncParticleDataArrays(),this._updateVertexData();var a=this.meshData;a.rebuildData(a.vertexCount,a.indexCount),this._vertexDataDirty=!0,this._updateIndexBuffer(this.particles),this._updateUniforms()},e.prototype._syncParticleDataArrays=function(){for(var a=this.particlesSorted,b=this.particles,c=this.maxParticles;a.length<c;){var d=new p(this);d.index=a.length,d.loopAfter=this.duration,a.push(d),b.push(d)}for(;a.length>c;){var d=b.pop();a.splice(a.indexOf(d),1)}},e.prototype._updateVertexData=function(){var a,b,c=this.meshData,e=this.maxParticles,f=this.particles,g=this.duration,h=this.material,i=c.getAttributeBuffer(j.TEXCOORD0),k=c.getAttributeBuffer(j.POSITION),l=c.getIndexBuffer(),m=this.mesh,n=m.getIndexBuffer(),o=m.getAttributeBuffer(j.POSITION),p=m.getAttributeBuffer(j.TEXCOORD0),q=m.vertexCount;for(a=0;e>a;a++){for(var b=0;b<p.length;b++)i[a*p.length+b]=p[b];for(var b=0;b<o.length;b++)k[a*o.length+b]=o[b];for(var b=0;b<n.length;b++)l[a*n.length+b]=n[b]+a*q}c.setAttributeDataUpdated(j.TEXCOORD0),c.setAttributeDataUpdated(j.POSITION),this.localSpace&&this._loop?h.shader.setDefine("LOOP",!0):h.shader.removeDefine("LOOP"),this.preWarm?h.shader.removeDefine("HIDE_IF_EMITTED_BEFORE_ZERO"):h.shader.setDefine("HIDE_IF_EMITTED_BEFORE_ZERO",!0);var r=c.getAttributeBuffer("TIME_INFO"),s=this.emissionRate;if(this.localSpace){for(var t=Math.min(Math.ceil(60*g),1e5),u=0,v=0,w=s.getIntegralValueAt(1),a=0;e>u&&t>a;a++){var x=(Math.floor(a/t)*w+s.getIntegralValueAt(a/t%1))*g,y=Math.floor(x-u);for(u+=y;u>v&&e>v;)f[v++].emitTime=a/t*g;if(v>=e)break}for(;e>v;){var z=f[v];z.emitTime=2*g,z.active=0,v++}}var A=this.preWarm,B=this.loop;for(a=0;e>a;a++){var z=f[a],C=z.emitRandom=this._random(),D=d(z.emitTime/g,1);if(z.lifeTime=this.startLifetime.getValueAt(D,this._random()),this.localSpace){if(A&&B&&(z.emitTime-=g),B){var E=z.emitTime;(!A&&E>=0||A)&&(0>=E&&A||g>=E&&!A)?z.active=1:z.active=0,z.loopAfter=Math.max(g,z.lifeTime)}}else z.emitTime=-2*z.lifeTime,z.active=0;for(b=0;q>b;b++)r[4*q*a+4*b+0]=z.lifeTime,r[4*q*a+4*b+1]=z.active,r[4*q*a+4*b+2]=C,r[4*q*a+4*b+3]=z.emitTime}c.setAttributeDataUpdated("TIME_INFO");var F=c.getAttributeBuffer("START_POS"),G=c.getAttributeBuffer("START_DIR");for(a=0;e>a;a++){var z=f[a],k=z.startPosition,H=z.startDirection,D=z.emitTime/g%1;for(this._generateLocalPositionAndDirection(k,H,D),b=0;q>b;b++)F[4*q*a+4*b+0]=k.x,F[4*q*a+4*b+1]=k.y,F[4*q*a+4*b+2]=k.z,F[4*q*a+4*b+3]=0,G[4*q*a+4*b+0]=H.x,G[4*q*a+4*b+1]=H.y,G[4*q*a+4*b+2]=H.z,G[4*q*a+4*b+3]=z.loopAfter}c.setAttributeDataUpdated("START_POS"),c.setAttributeDataUpdated("START_DIR")},e.prototype._generateLocalPositionAndDirection=function(a,b,c){var d=this.shapeType,e=Math.cos,f=Math.sin,g=Math.PI;if("sphere"===d){var h=Math.acos(2*this._random()-1),i=2*g*this._random(),j=this.sphereRadius;this.sphereEmitFromShell||(j*=Math.cbrt(this._random())),a.setDirect(j*e(i)*f(h),j*e(h),j*f(i)*f(h)),b.setDirect(e(i)*f(h),e(h),f(i)*f(h))}else if("cone"===d){var i=2*g*this._random();switch(this.coneEmitFrom){case"base":var k=Math.sqrt(this._random()),j=this.coneRadius*k;a.setDirect(j*e(i),0,j*f(i));var l=(this.coneRadius+this.coneLength*Math.tan(this.coneAngle))*k;b.setDirect(l*e(i),this.coneLength,l*f(i)).sub(a);break;case"volume":var k=Math.sqrt(this._random()),j=this.coneRadius*k;a.setDirect(j*e(i),0,j*f(i));var l=(this.coneRadius+this.coneLength*Math.tan(this.coneAngle))*k;b.setDirect(l*e(i),this.coneLength,l*f(i)).sub(a),b.setDirect(l*e(i),this.coneLength,l*f(i)),a.lerp(b,this._random()),b.sub(a);break;case"volumeshell":var j=this.coneRadius;a.setDirect(j*e(i),0,j*f(i));var l=this.coneRadius+this.coneLength*Math.tan(this.coneAngle);b.setDirect(l*e(i),this.coneLength,l*f(i)),a.lerp(b,this._random()),b.sub(a)}}else a.setDirect(this._random()-.5,this._random()-.5,this._random()-.5).mul(this.boxExtents),b.setDirect(0,1,0);if(this.randomDirection){var h=Math.acos(2*this._random()-1),i=2*g*this._random();b.setDirect(e(i)*f(h),e(h),f(i)*f(h))}var m=this.startSpeed.getValueAt(c,this._random());b.normalize().scale(m)},e.prototype.emitOne=function(a,b){var c=this.meshData,d=c.getAttributeBuffer("START_POS"),e=c.getAttributeBuffer("START_DIR"),f=c.getAttributeBuffer("TIME_INFO"),g=this._nextEmitParticleIndex;this._nextEmitParticleIndex=(this._nextEmitParticleIndex+1)%this.maxParticles;var h=this.particles[g],i=h.startPosition,j=h.startDirection;h.emitTime=this.time,i.copy(a),j.copy(b),h.active=1;for(var k=this.mesh.vertexCount,l=h.emitRandom=this._random(),m=0;k>m;m++)f[4*k*g+4*m+0]=h.lifeTime,f[4*k*g+4*m+1]=h.active,f[4*k*g+4*m+2]=l,f[4*k*g+4*m+3]=h.emitTime,d[4*k*g+4*m+0]=i.x,d[4*k*g+4*m+1]=i.y,d[4*k*g+4*m+2]=i.z,d[4*k*g+4*m+3]=0,e[4*k*g+4*m+0]=j.x,e[4*k*g+4*m+1]=j.y,e[4*k*g+4*m+2]=j.z,e[4*k*g+4*m+3]=h.loopAfter;c.setAttributeDataUpdated("START_POS"),c.setAttributeDataUpdated("START_DIR"),c.setAttributeDataUpdated("TIME_INFO")},e.prototype._updateBounds=function(){if(this.meshEntity&&this.meshEntity.meshRendererComponent.worldBound){var a=this.meshEntity.meshRendererComponent.worldBound;a.center.copy(this.entity.transformComponent.sync().worldTransform.translation);var b=this.boundsRadius;a.xExtent=a.yExtent=a.zExtent=2*b}};var v=new h;e.prototype._sortParticles=function(){if(this.sortMode!==e.SORT_NONE){for(var a=this.particlesSorted,b=a.length;b--;){var c=a[b];c.sortValue=-c.getWorldPosition(v).dot(q.mainCamera._direction)}for(var d=a,f=1,b=d.length;b>f;f++){for(var g=d[f],h=f-1;h>=0&&!(d[h].sortValue<=g.sortValue);h--)d[h+1]=d[h];d[h+1]=g}this._updateIndexBuffer(a)}};var w=new h,x=new h;e.prototype.process=function(a){this._vertexDataDirty&&(this._updateVertexData(),this._vertexDataDirty=!1),this.meshEntity.meshRendererComponent.hidden=this.entity.isVisiblyHidden();var b=this.entity,c=b.transformComponent.sync().worldTransform,e=this.particles;if(this.localSpace){var g=this.meshEntity;f(g.transformComponent.transform,b.transformComponent.transform),f(g.transformComponent.sync().worldTransform,b.transformComponent.worldTransform)}if(!this.paused){this._lastTime=this.time,this.time+=a;var h=this.time;if(!this.localSpace){var i=this.emissionRate,j=this.loop,k=this.duration,l=d(h/k,1),m=Math.floor(h*i.getValueAt(l,this._random()))-Math.floor(this._lastTime*i.getValueAt(l,this._random()));!j&&h>k&&(m=0);for(var n=0;m>n;n++){if(j){var o=this._findGoodParticle();if(!o)continue;this._nextEmitParticleIndex=o.index}else{var o=e[this._nextEmitParticleIndex];if(o.active)continue}this._generateLocalPositionAndDirection(w,x,l),w.applyPostPoint(c.matrix),x.applyPost(c.rotation),this.emitOne(w,x)}}this._updateUniforms(),this._sortParticles(),this._updateBounds()}},e.prototype._findGoodParticle=function(){for(var a=this.time,b=this.particles,c=this._nextEmitParticleIndex;c<this._nextEmitParticleIndex+b.length;c++){var d=b[c%b.length],e=a-d.emitTime;if(e>d.lifeTime)return d}},e.prototype.attached=function(a){this.entity=a,this._syncParticleDataArrays();var b=j.defaultMap([j.POSITION,j.TEXCOORD0]);b.TIME_INFO=j.createAttribute(4,"Float"),b.START_POS=j.createAttribute(4,"Float"),b.START_DIR=j.createAttribute(4,"Float");var c=this.maxParticles,d=new j(b,c*this.mesh.vertexCount,c*this.mesh.indexCount);d.vertexData.setDataUsage("DynamicDraw"),this.meshData=d;var e=new l(this.material);e.castShadows=e.receiveShadows=e.isPickable=e.isReflectable=!1,this.meshEntity=this.entity._world.createEntity(d,"ParticleSystemComponentMesh").set(e).addToWorld(),this.localSpace=this._localSpace,this._vertexDataDirty=!0},e.prototype.detached=function(){this.meshEntity.clearComponent("MeshDataComponent"),this.particles.length=this.particlesSorted.length=0,this.meshEntity.removeFromWorld(),this.entity=this.meshEntity=null},e.applyOnEntity=function(a,b){a instanceof e&&b.setComponent(a)},e.prototype.clone=function(){return new e(this)},a.exports=e},423:function(a,b,c){function d(a){this.component=a,this.index=0,this.lifeTime=1,this.emitTime=0,this.active=1,this.startPosition=new e,this.startDirection=new e,this.startAngle=0,this.startSize=1,this.sortValue=0,this.emitRandom=0,this.loopAfter=0}var e=c(8),f=new e,g=new e,h=new e,i=new e;d.prototype.getWorldPosition=function(a){if(!this.active)return a;var b=this.component,c=b.time-this.emitTime;if(b.loop&&(c%=this.loopAfter),f.copy(this.startDirection).scale(c),g.copy(b.localSpace?b._localGravity:b.gravity).scale(c*c*.5),a.copy(this.startPosition).add(f).add(g),b.localVelocityOverLifetime){var d=c/this.loopAfter;b.localVelocityOverLifetime.getVec3IntegralValueAt(d,this.emitRandom,h),h.applyPost(b._localToWorldRotation),a.add(h)}if(b.worldVelocityOverLifetime){var d=c/this.loopAfter;b.worldVelocityOverLifetime.getVec3IntegralValueAt(d,this.emitRandom,i),i.applyPost(b._worldToLocalRotation),a.add(i)}if(b.localSpace){var e=b.entity.transformComponent.sync().worldTransform;a.applyPost(e.rotation),a.add(e.translation)}return a},a.exports=d},424:function(a,b,c){function d(a){a=a||{},e.call(this,a),this.value=void 0!==a.value?a.value:1}var e=c(425);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.toGLSL=function(){return e.numberToGLSL(this.value)},d.prototype.integralToGLSL=function(a){var b=e.numberToGLSL(this.value);return"("+b+"*"+a+")"},d.prototype.getValueAt=function(){return this.value},d.prototype.getIntegralValueAt=function(a){return this.value*a},a.exports=d},425:function(a,b){function c(a){a=a||{},this.type=a.type||"float",this.timeOffset=a.timeOffset||0}c.numberToGLSL=function(a){return-1===(a+"").indexOf(".")?a+".0":a+""},c.prototype={toGLSL:function(){return"0.0"},getValueAt:function(){return 0},getVec4ValueAt:function(){},getIntegralValueAt:function(){return 0},getVec4IntegralValueAt:function(){},clone:function(){return new this.constructor(this)}},a.exports=c},426:function(a,b,c){function d(a){a=a||{},e.call(this,a),this.curveA=void 0!==a.curveA?a.curveA.clone():null,this.curveB=void 0!==a.curveB?a.curveB.clone():null}var e=c(425),f=c(9);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.toGLSL=function(a,b){return"mix("+this.curveA.toGLSL(a,b)+","+this.curveB.toGLSL(a,b)+","+b+")"},d.prototype.integralToGLSL=function(a,b){return"mix("+this.curveA.integralToGLSL(a,b)+","+this.curveB.integralToGLSL(a,b)+","+b+")"},d.prototype.getValueAt=function(a,b){return f.lerp(b,this.curveA.getValueAt(a,b),this.curveB.getValueAt(a,b))},d.prototype.getIntegralValueAt=function(a,b){return f.lerp(b,this.curveA.getIntegralValueAt(a,b),this.curveB.getIntegralValueAt(a,b))},a.exports=d},427:function(a,b,c){function d(a){a=a||{},e.call(this,a),this.k=void 0!==a.k?a.k:1,this.m=a.m||0}var e=c(425);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.fromStartEnd=function(a,b){this.m=a,this.k=b-a},d.prototype.toGLSL=function(a){return"("+e.numberToGLSL(this.k)+"*"+a+"+"+e.numberToGLSL(this.m)+")"},d.prototype.integralToGLSL=function(a){var b=e.numberToGLSL(this.k),c=e.numberToGLSL(this.m);return"("+b+"*"+a+"*"+a+"*0.5+"+c+"*"+a+")"},d.prototype.getValueAt=function(a){return this.k*(a-this.timeOffset)+this.m},d.prototype.getIntegralValueAt=function(a){var b=a-this.timeOffset,c=this.k,d=this.m;return.5*c*b*b+d*b},a.exports=d},428:function(a,b,c){function d(a){a=a||{},e.call(this,a),this.segments=a.segments?a.segments.map(function(a){return a.clone()}):[]}var e=c(425);d.prototype={clone:function(){return new d(this)},addSegment:function(a){this.segments.push(a),this.sort()},removeSegment:function(a){this.segments.splice(a,1)},sort:function(){this.segments=this.segments.sort(function(a,b){return a.timeOffset-b.timeOffset})},toGLSL:function(a,b){for(var c=this.segments,d=[],f=0;f<c.length;f++){var g=c[f],h=e.numberToGLSL(g.timeOffset),i="1.0";f<c.length-1&&(i=e.numberToGLSL(c[f+1].timeOffset)),d.push("step("+h+",t)*step(-"+i+",-t)*"+g.toGLSL(a,b))}return d.join("+")},integralToGLSL:function(a,b){for(var c=this.segments,d=[],f=0;f<c.length;f++){var g=c[f],h=e.numberToGLSL(g.timeOffset),i="1.0";f<c.length-1&&(i=e.numberToGLSL(c[f+1].timeOffset)),d.push(g.integralToGLSL("clamp("+a+","+h+","+i+")",b))}return d.join("+")},getValueAt:function(a,b){for(var c=this.segments,d=0;d<c.length-1;d++){var e=c[d],f=c[d+1];if(e.timeOffset<=a&&f.timeOffset>a)return this.segments[d].getValueAt(a,b)}return this.segments[c.length-1].getValueAt(a,b)},getIntegralValueAt:function(a,b){for(var c=this.segments,d=0,e=0;e<c.length;e++){var f=c[e],g=1;if(e<c.length-1&&(g=c[e+1].timeOffset),f.timeOffset<=a&&g>a){d+=this.segments[e].getIntegralValueAt(a,b);break}d+=this.segments[e].getIntegralValueAt(g,b)}return d}},a.exports=d},429:function(a,b,c){function d(a){if(a=a||{},a=g.clone(a),a.type="vec3",f.call(this,a),this.x=a.x?a.x.clone():new e,this.y=a.y?a.y.clone():new e,this.z=a.z?a.z.clone():new e,"float"!==this.x.type||"float"!==this.y.type||"float"!==this.z.type)throw new Error("Vector3Curve must have scalar components.")}var e=c(424),f=c(425),g=c(6);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.toGLSL=function(a,b){return"vec3("+[this.x,this.y,this.z].map(function(c){return c.toGLSL(a,b)}).join(",")+")"},d.prototype.integralToGLSL=function(a,b){return"vec3("+[this.x,this.y,this.z].map(function(c){return c.integralToGLSL(a,b)}).join(",")+")"},d.prototype.getVec3ValueAt=function(a,b,c){c.setDirect(this.x.getValueAt(a,b),this.y.getValueAt(a,b),this.z.getValueAt(a,b))},d.prototype.getVec3IntegralValueAt=function(a,b,c){c.setDirect(this.x.getIntegralValueAt(a,b),this.y.getIntegralValueAt(a,b),this.z.getIntegralValueAt(a,b))},a.exports=d},430:function(a,b,c){function d(a){if(a=a||{},a=g.clone(a),a.type="vec4",f.call(this,a),this.x=a.x?a.x.clone():new e,this.y=a.y?a.y.clone():new e,this.z=a.z?a.z.clone():new e,this.w=a.w?a.w.clone():new e({value:1}),"float"!==this.x.type||"float"!==this.y.type||"float"!==this.z.type||"float"!==this.w.type)throw new Error("Vector4Curve must have scalar components.");
}var e=c(424),f=c(425),g=c(6);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.toGLSL=function(a,b){return"vec4("+[this.x,this.y,this.z,this.w].map(function(c){return c.toGLSL(a,b)}).join(",")+")"},d.prototype.integralToGLSL=function(a,b){return"vec4("+[this.x,this.y,this.z,this.w].map(function(c){return c.integralToGLSL(a,b)}).join(",")+")"},d.prototype.getVec4ValueAt=function(a,b,c){c.setDirect(this.x.getValueAt(a,b),this.y.getValueAt(a,b),this.z.getValueAt(a,b),this.w.getValueAt(a,b))},d.prototype.getVec4IntegralValueAt=function(a,b,c){c.setDirect(this.x.getIntegralValueAt(a,b),this.y.getIntegralValueAt(a,b),this.z.getIntegralValueAt(a,b),this.w.getIntegralValueAt(a,b))},a.exports=d},431:function(a,b,c){function d(){j.apply(this,arguments),this._cachedPresetTextures={},this._type="ParticleSystemComponent"}function e(a){return[{type:"constant",offset:0,value:a}]}function f(a,b){return[{type:"linear",offset:0,k:a,m:b}]}function g(a,b){b=void 0!==b?b:1;for(var c=new n,d=0;d<a.length;d++){var e=a[d];switch(e.type){case"linear":c.addSegment(new l({timeOffset:e.offset,k:e.k*b,m:e.m*b}));break;case"constant":c.addSegment(new m({timeOffset:e.offset,value:e.value*b}));break;case"lerp":c.addSegment(new q({timeOffset:e.offset,curveA:g(e.curveA,b),curveB:g(e.curveB,b)}))}}return c}function h(a){return new o({x:g(a[0]),y:g(a[1]),z:g(a[2])})}function i(a){return new p({x:g(a[0]),y:g(a[1]),z:g(a[2]),w:g(a[3])})}var j=c(88),k=c(422),l=c(427),m=c(424),n=c(428),o=c(429),p=c(430),q=c(426),r=c(55),s=c(6),t=c(8),u=c(9),v=c(210);d.prototype=Object.create(j.prototype),d.prototype.constructor=d,j._registerClass("particleSystem",d),d.prototype._prepare=function(a){return s.defaults(a,{gravity:[0,0,0],seed:-1,shapeType:"cone",sphereRadius:1,sphereEmitFromShell:!1,randomDirection:!1,coneEmitFrom:"base",boxExtents:[1,1,1],coneRadius:1,coneAngle:10,coneLength:1,startColor:[e(1),e(1),e(1),e(1)],colorOverLifetime:[e(1),e(1),e(1),e(1)],duration:5,localSpace:!0,startSpeed:e(5),localVelocityOverLifetime:[e(0),e(0),e(0)],worldVelocityOverLifetime:[e(0),e(0),e(0)],maxParticles:100,emissionRate:e(10),startLifetime:e(5),renderQueue:3010,discardThreshold:0,loop:!1,preWarm:!0,blending:"NoBlending",depthWrite:!0,depthTest:!0,textureTilesX:1,textureTilesY:1,textureAnimationCycles:1,textureFrameOverLifetime:f(1,0),startSize:e(1),sortMode:"none",billboard:!0,sizeOverLifetime:e(1),startAngle:e(0),rotationSpeedOverLifetime:e(0),texturePreset:"Custom",textureRef:null})},d.prototype._create=function(){return new k},d.prototype._remove=function(a){a.clearComponent("ParticleSystemComponent")},d.prototype.update=function(a,b,c){var d=this;return j.prototype.update.call(this,a,b,c).then(function(a){if(a){a.gravity.setArray(b.gravity),a.seed=b.seed,a.shapeType=b.shapeType,a.sphereRadius=b.sphereRadius,a.sphereEmitFromShell=b.sphereEmitFromShell,a.randomDirection=b.randomDirection,a.coneEmitFrom=b.coneEmitFrom,a.setBoxExtents(new t(b.boxExtents)),a.coneRadius=b.coneRadius,a.coneAngle=b.coneAngle*u.DEG_TO_RAD,a.coneLength=b.coneLength,a.startColor=i(b.startColor),a.colorOverLifetime=i(b.colorOverLifetime),a.duration=b.duration,a.localSpace=b.localSpace,a.startSpeed=g(b.startSpeed),a.localVelocityOverLifetime=h(b.localVelocityOverLifetime),a.worldVelocityOverLifetime=h(b.worldVelocityOverLifetime),a.maxParticles=b.maxParticles,a.emissionRate=g(b.emissionRate),a.startLifetime=g(b.startLifetime),a.renderQueue=b.renderQueue,a.discardThreshold=b.discardThreshold,a.loop=b.loop,a.preWarm=b.preWarm,a.blending=b.blending,a.depthWrite=b.depthWrite,a.depthTest=b.depthTest,a.textureTilesX=b.textureTilesX,a.textureTilesY=b.textureTilesY,a.textureFrameOverLifetime=g(b.textureFrameOverLifetime),a.textureAnimationCycles=b.textureAnimationCycles,a.startSize=g(b.startSize),a.sortMode={none:k.SORT_NONE,camera_distance:k.SORT_CAMERA_DISTANCE}[b.sortMode],a.billboard=b.billboard,a.sizeOverLifetime=g(b.sizeOverLifetime),a.startAngle=g(b.startAngle,u.DEG_TO_RAD),a.rotationSpeedOverLifetime=g(b.rotationSpeedOverLifetime,u.DEG_TO_RAD),a.autoPlay=b.autoPlay,a.paused||a.stop(),a.autoPlay&&a.play();var e=[],f=d._cachedPresetTextures,j=b.texture&&b.texture.enabled&&b.texture.textureRef;return j&&"Custom"===b.texturePreset?e.push(d._load(j,c).then(function(b){return a.texture=b,a}).then(null,function(a){throw new Error("Error loading texture: "+j+" - "+a)})):"Flare"===b.texturePreset?(f.Flare=f.Flare||v.createFlareTexture(32),a.texture=f.Flare):"Splash"===b.texturePreset?(f.Splash=f.Splash||v.createSplashTexture(32),a.texture=f.Splash):"Plankton"===b.texturePreset?(f.Plankton=f.Plankton||v.createPlanktonTexture(32),a.texture=f.Plankton):"Snowflake"===b.texturePreset?(f.Snowflake=f.Snowflake||v.createSnowflakeTexture(32),a.texture=f.Snowflake):a.texture=null,e.length?r.all(e).then(function(){return a}):a}})},a.exports=d},432:function(a,b,c){function d(){f.call(this,"ParticleDebugRenderSystem",["ParticleSystemComponent"]),this.priority=3,this.renderList=[],this.camera=null,g.addListener("goo.setCurrentCamera",function(a){this.camera=a.camera}.bind(this)),this.renderAll=!0,this.selection=new e;var a=new i(j.simpleColored);a.uniforms.color=[0,1,0],this.sphereRenderable={materials:[a],transform:new h,meshData:new k(12,12,1)},this.boxRenderable={materials:[a],transform:new h,meshData:new l(1,1,1)},this.coneRenderable={materials:[a],transform:new h,meshData:new m(16,1,1,1)},this.offsetTransform=new h}var e=c(21),f=c(42),g=c(44),h=c(41),i=c(30),j=c(46),k=c(29),l=c(27),m=c(117);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.particleSystemComponent.meshEntity;d&&(c.isVisiblyHidden()?d.meshRendererComponent.hidden=!0:d.meshRendererComponent.hidden=!this._shouldRenderDebugForEntity(c))}},d.prototype._shouldRenderDebugForEntity=function(a){return!this.passive&&(this.renderAll||this.selection.contains(a))},d.prototype.render=function(a){if(this.camera&&!this.passive){a.checkResize(this.camera);for(var b=this._activeEntities,c=0,d=b.length;c!==d;c++){var e=b[c];if(this.renderAll||this.selection.contains(e)){var f;switch(e.particleSystemComponent.shapeType){case"sphere":f=this.sphereRenderable;var g=e.particleSystemComponent.sphereRadius;f.transform.scale.setDirect(g,g,g),this.offsetTransform.setIdentity();break;case"box":f=this.boxRenderable,f.transform.scale.copy(e.particleSystemComponent.boxExtents),this.offsetTransform.setIdentity();break;case"cone":var h=e.particleSystemComponent.coneRadius;f=this.coneRenderable,this.offsetTransform.setIdentity(),f.meshData.radiusTop=h+Math.tan(e.particleSystemComponent.coneAngle)*e.particleSystemComponent.coneLength,f.meshData.radiusBottom=h,f.meshData.height=e.particleSystemComponent.coneLength,f.meshData.rebuild(),f.meshData.setVertexDataUpdated(),this.offsetTransform.translation.set(0,0,.5*e.particleSystemComponent.coneLength),this.offsetTransform.rotation.rotateX(3*Math.PI/2)}if(f){f.meshData.indexModes=["Lines"];var i=f.transform,j=e.transformComponent.sync().worldTransform;i.rotation.copy(this.offsetTransform.rotation),i.rotation.mul(j.rotation),this.offsetTransform.translation.applyPost(i.rotation),i.translation.copy(this.offsetTransform.translation).add(j.translation),i.update(),a.render(f,this.camera,null,null,!1)}}}}},d.prototype.cleanup=function(){},d.prototype.update=function(){if(!this.passive){for(var a=this._activeEntities,b=a.length;b--;){var c=a[b];this._shouldRenderDebugForEntity(c)?c.particleSystemComponent.play():c.particleSystemComponent.stop()}this.process(this._activeEntities)}},a.exports=d},433:function(a,b,c){function d(){e.call(this,"ParticleSystemSystem",["ParticleSystemComponent","TransformComponent"]),this.priority=1}var e=c(42);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.process=function(a,b){for(var c=0;c<a.length;c++)a[c].particleSystemComponent.process(b)},d.prototype.inserted=function(){},d.prototype.deleted=function(){},d.prototype.removedComponent=function(){},d.prototype.pause=function(){for(var a=this._activeEntities,b=0;b<a.length;b++)a[b].particleSystemComponent.pause()},d.prototype.resume=function(){for(var a=this._activeEntities,b=0;b<a.length;b++)a[b].particleSystemComponent.resume()},d.prototype.play=function(){for(var a=this._activeEntities,b=0;b<a.length;b++){var c=a[b].particleSystemComponent;c.autoPlay&&c.play()}},d.prototype.stop=function(){this.pause();for(var a=this._activeEntities,b=0;b<a.length;b++)a[b].particleSystemComponent.stop()},a.exports=d}});